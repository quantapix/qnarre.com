<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A quick narrative analyzer for &lsquo;bipolar&rsquo; text"><meta name=author content="Qnarre - Software is our passion"><meta name=generator content="Hugo 0.101.0"><meta name=docsearch:language content="en"><meta name=docsearch:version content="0.1.0"><title>Predatory Profits Of &ldquo;High-Conflict&rdquo; Divorces Â· Qnarre</title><link rel=canonical href=https://quantapix.github.io/modeling/conflict/><link href=../../css/bootstrap.min.css rel=stylesheet><link href=../../css/style.css rel=stylesheet><link rel=apple-touch-icon href=../../img/favs/apple-touch-icon.png sizes=180x180><link rel=icon href=../../img/favs/favicon-32x32.png sizes=32x32 type=image/png><link rel=icon href=../../img/favs/favicon-16x16.png sizes=16x16 type=image/png><link rel=manifest href=../../img/favs/manifest.json><link rel=mask-icon href=../../img/favs/safari-pinned-tab color=#7952b3><link rel=icon href=../../img/favs/favicon.ico><meta name=theme-color content="#7952b3"></head><body><div class="skippy visually-hidden-focusable overflow-hidden"><div class=container-xl><a class="d-inline-flex p-2 m-1" href=#content>Skip to content</a></div></div><header class="navbar navbar-expand-md navbar-dark qal-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-2" href=../../><svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" class="d-block my-1" viewBox="0 0 118 94" role="img"><title>Silcrow</title><path d="m67.476567 58.848956q2.916668 2.114585 4.375002 4.812503t1.458334 5.942711q0 5.250002-4.520836 8.421879-4.520835 3.208335-10.60938 3.208335-5.541669.0-9.406254-2.552085-3.864586-2.552084-3.864586-6.270836.0-2.151043 1.421876-3.500002 1.421876-1.3125 3.208335-1.3125 1.932293.0 3.026043 1.09375 1.093751 1.130209 1.786459 3.609377.911459 3.09896 2.296876 3.97396 1.385418.911459 3.208335.911459 2.187501.0 3.75521-1.239584t1.567709-3.026043q0-1.458334-1.020833-3.135418-1.057293-1.640626-6.708337-5.468753-6.526045-4.375002-9.369796-6.781253-2.843751-2.44271-4.375002-5.322919-1.531251-2.916669-1.531251-6.19792.0-3.09896 1.348959-5.432294 1.385417-2.333335 3.208335-3.427085 1.822918-1.130209 4.302085-1.713543-3.098959-2.260418-4.666668-4.921877-1.56771-2.66146-1.56771-5.76042.0-5.322919 4.484378-8.640629 4.484377-3.354168 10.901046-3.354168 5.395836.0 9.333338 2.515626t3.937502 6.088545q0 2.114584-1.494792 3.463543-1.494793 1.348959-3.427085 1.348959-1.895834.0-2.843752-.984375-.947917-1.020834-1.859376-3.718752-.838542-2.552085-2.078125-3.609377-1.239584-1.057292-3.463544-1.057292-2.296876.0-3.937502 1.276042-1.604167 1.276043-1.604167 3.062502.0 2.041667 1.567709 3.682293 1.531251 1.640626 7.473962 5.432294 5.578128 3.572919 8.239587 5.76042 2.697918 2.151043 4.229169 5.140627 1.567709 2.989585 1.567709 6.453128.0 4.411461-2.078126 7.218754-2.078126 2.807293-6.270836 4.010418zm1.166667-7.000003q0-3.682293-6.234378-8.531254-6.19792-4.885419-9.187505-4.885419-1.385417.0-2.661459 1.09375-1.239584 1.057293-1.239584 2.515627.0 3.463543 6.307295 8.421879 6.343753 4.958335 9.260421 4.958335 1.53125.0 2.625001-1.057292 1.130209-1.057292 1.130209-2.515626z" fill="#fff"/></svg></a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#qalNavbar aria-controls=qalNavbar aria-expanded=false aria-label="Toggle navigation"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" class="bi" fill="currentcolor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 11.5A.5.5.0 013 11h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5zm0-4A.5.5.0 013 7h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5zm0-4A.5.5.0 013 3h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5z"/></svg></button><div class="collapse navbar-collapse" id=qalNavbar><hr class="d-md-none text-white-50"><ul class="navbar-nav flex-row flex-wrap qal-navbar-nav"><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2" href=../../>Qnarre</a></li><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2 active" aria-current=true href=../../modeling/>Modeling</a></li><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2" href=../../semantics/>Semantics</a></li><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2" href=../../analytics/>Analytics</a></li><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2" href=../../reports/>Reports</a></li><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2" href=../../story/>The Story</a></li></ul><hr class="d-md-none text-white-50"><ul class="navbar-nav flex-row flex-wrap ms-md-auto"><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2" href=https://twitter.com/ikifor target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" class="navbar-nav-svg d-inline-block align-text-top" viewBox="0 0 512 416.32" role="img"><title>Twitter</title><path fill="currentcolor" d="M160.83 416.32c193.2.0 298.92-160.22 298.92-298.92.0-4.51.0-9-.2-13.52A214 214 0 00512 49.38a212.93 212.93.0 01-60.44 16.6 105.7 105.7.0 0046.3-58.19 209 209 0 01-66.79 25.37 105.09 105.09.0 00-181.73 71.91 116.12 116.12.0 002.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48.0 0068 159.6a106.27 106.27.0 01-47.53-13.11v1.43a105.28 105.28.0 0084.21 103.06 105.67 105.67.0 01-47.33 1.84 105.06 105.06.0 0098.14 72.94A210.72 210.72.0 0125 370.84a202.17 202.17.0 01-25-1.43 298.85 298.85.0 00160.83 46.92"/></svg><small class="d-md-none ms-2">Twitter</small></a></li><li class="nav-item col-6 col-md-auto"><a class="nav-link p-2" href=https://github.com/quantapix target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" class="navbar-nav-svg d-inline-block align-text-top" viewBox="0 0 512 499.36" role="img"><title>GitHub</title><path fill="currentcolor" fill-rule="evenodd" d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 01128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z"/></svg><small class="d-md-none ms-2">GitHub</small></a></li></ul><a class="btn btn-qal-download d-lg-inline-block my-2 my-md-0 ms-md-3" href=../../simlaw/>SimLaw.app</a></div></nav></header><div class="container-xxl my-md-4 qal-layout"><aside class=qal-sidebar><nav class="collapse qal-links" id=qal-docs-nav aria-label="Nav links"><ul class="list-unstyled mb-0 py-3 pt-md-1"><li class=mb-1><button class="btn d-inline-flex align-items-center rounded" data-bs-toggle=collapse data-bs-target=#modeling-collapse aria-expanded=true aria-current=true>
Modeling</button><div class="collapse show" id=modeling-collapse><ul class="list-unstyled fw-normal pb-1 small"><li><a href=../../modeling/./ class="d-inline-flex align-items-center rounded">Overview</a></li><li><a href=../../modeling/simulation class="d-inline-flex align-items-center rounded">Judicial Simulation</a></li><li><a href=../../modeling/concepts class="d-inline-flex align-items-center rounded">Conceptual Model</a></li><li><a href=../../modeling/report class="d-inline-flex align-items-center rounded">Sample Report</a></li></ul></div></li><li class=mb-1><button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#semantics-collapse aria-expanded=false>
Semantics</button><div class=collapse id=semantics-collapse><ul class="list-unstyled fw-normal pb-1 small"><li><a href=../../semantics/./ class="d-inline-flex align-items-center rounded">Overview</a></li><li><a href=../../semantics/simulation class="d-inline-flex align-items-center rounded">Judicial Simulation</a></li><li><a href=../../semantics/concepts class="d-inline-flex align-items-center rounded">Conceptual Model</a></li></ul></div></li><li class=mb-1><button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#analytics-collapse aria-expanded=false>
Analytics</button><div class=collapse id=analytics-collapse><ul class="list-unstyled fw-normal pb-1 small"><li><a href=../../analytics/./ class="d-inline-flex align-items-center rounded">Overview</a></li><li><a href=../../analytics/prepare class="d-inline-flex align-items-center rounded">Preparing Documents</a></li><li><a href=../../analytics/extract class="d-inline-flex align-items-center rounded">Extracting Narratives</a></li><li><a href=../../analytics/output class="d-inline-flex align-items-center rounded">Standardized Output</a></li><li><a href=../../analytics/graph class="d-inline-flex align-items-center rounded">Conflict Graph</a></li><li><a href=../../analytics/analyze class="d-inline-flex align-items-center rounded">Irrefutable Analytics</a></li></ul></div></li><li class=mb-1><button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#reports-collapse aria-expanded=false>
Reports</button><div class=collapse id=reports-collapse><ul class="list-unstyled fw-normal pb-1 small"><li><a href=../../reports/./ class="d-inline-flex align-items-center rounded">Overview</a></li><li><a href=../../reports/prepare class="d-inline-flex align-items-center rounded">Generating Reports</a></li></ul></div></li><li class=mb-1><button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#story-collapse aria-expanded=false>
The Story</button><div class=collapse id=story-collapse><ul class="list-unstyled fw-normal pb-1 small"><li><a href=../../story/./ class="d-inline-flex align-items-center rounded">Overview</a></li><li><a href=../../story/about class="d-inline-flex align-items-center rounded">About</a></li><li><a href=../../story/blog class="d-inline-flex align-items-center rounded">Blog</a></li></ul></div></li><li class=mb-1><button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#tech-collapse aria-expanded=false>
Available Tech</button><div class=collapse id=tech-collapse><ul class="list-unstyled fw-normal pb-1 small"><li><a href=../../tech/./ class="d-inline-flex align-items-center rounded">Overview</a></li><li><a href=../../tech/trackable class="d-inline-flex align-items-center rounded">Trackable Persistence</a></li><li><a href=../../tech/gpus class="d-inline-flex align-items-center rounded">Many Smaller GPUs</a></li><li><a href=../../tech/dataset class="d-inline-flex align-items-center rounded">Datasets</a></li><li><a href=../../tech/masking class="d-inline-flex align-items-center rounded">Unified Masking</a></li><li><a href=../../tech/ragged class="d-inline-flex align-items-center rounded">Ragged Tensors</a></li><li><a href=../../tech/layers class="d-inline-flex align-items-center rounded">Layers Simplified</a></li><li><a href=../../tech/custom class="d-inline-flex align-items-center rounded">Custom Layers</a></li><li><a href=../../tech/autograph class="d-inline-flex align-items-center rounded">Autograph</a></li><li><a href=../../tech/metrics class="d-inline-flex align-items-center rounded">Modular Metrics</a></li><li><a href=../../tech/callbacks class="d-inline-flex align-items-center rounded">Extended Callbacks</a></li></ul></div></li></ul></nav></aside><main class="qal-main order-1"><div class="qal-intro ps-lg-4"><div class="d-md-flex flex-md-row align-items-center justify-content-between"><h1 class=qal-title id=content>Predatory Profits Of &ldquo;High-Conflict&rdquo; Divorces</h1></div><p class=qal-lead></p></div><div class="qal-toc mt-4 mb-5 my-md-0 ps-xl-3 mb-lg-5 text-muted"><strong class="d-block h6 my-2 pb-2 border-bottom">On this page</strong><nav id=TableOfContents><ul><li><a href=#direct-contradictions-and-conflicts>Direct contradictions and conflicts</a></li><li><a href=#synthesized-samples>Synthesized samples</a></li><li><a href=#model-definition>Model definition</a></li><li><a href=#expanded-parameters>Expanded parameters</a></li><li><a href=#generating-samples>Generating samples</a></li><li><a href=#training-session>Training session</a></li></ul></nav></div><div class="qal-content ps-lg-4"><p>For a justification of this blog, please consider the following chain of conjectures (referenced &ldquo;lawyers&rdquo; would be the <strong>divorce lawyer</strong> types):</p><ul><li>our common law is adversarial, the winner simply takes all</li><li>a family, by definition, is not adversarial, as fundamentally both parents love their children</li><li>however, with no adversarial conflict, there is no lawsuit and no profits for lawyers</li><li>thus our common law applied to families must first turn a family into adversaries</li><li>by definition, either unsolved conflicts or perceived lack of resources create adversaries</li><li>moreover, sustainably intractable conflicts guarantee adversaries for life or &ldquo;high-conflict&rdquo;</li><li>however, with no money, i.e. no possible profits for lawyers, there simply cannot be &ldquo;high-conflicts&rdquo;</li><li>&ldquo;high-conflict&rdquo; cases thus are an ambitious, i.e. ruthless, lawyer&rsquo;s &ldquo;gold mines&rdquo; and job-security</li><li>lawyers are in overabundance and competition is fierce, as one only needs to be a malicious actor</li><li>however, with no &ldquo;high-conflict&rdquo;, there are no trendsetting, &ldquo;interesting&rdquo; cases</li><li>with no trendsetting, there is no ~$500 / hour billing rate for ruthless, and narcissist, &ldquo;top lawyers&rdquo;</li></ul><p>Accepting the above chain of faultless logic, what can a deeply narcissist divorce lawyer do?</p><ul><li>in cases lacking conflicts, he has only one choice: provoke or <strong>flat-out fabricate a conflict by blatantly lying</strong>, specifically for the Family Court&rsquo;s eager consumption</li><li>if he &ldquo;leaves money on the table&rdquo;, and neglects exploiting lucrative cases he has already hooked-onto, <strong>he will go hungry</strong> with everyone watching!</li></ul><h2 id=direct-contradictions-and-conflicts>Direct contradictions and conflicts</h2><p>In this blog we focus on <em>directly</em> fabricated conflicts, or flat-out, knowingly stated lies to the Family Courts by our lawyers. We are aided by the strict rules of the Court, as all meaningful communication must already be in (or should be convertible to) textual English &ldquo;inputs&rdquo;.</p><p>Our first goal is to train our computer to &ldquo;catch the knowingly and directly lying lawyer&rdquo; by systematically finding direct, irrefutable textual contradictions in <em>all</em> of a lawyer&rsquo;s communications.</p><p>Current state-of-the-art NLP research (see <a href=https://arxiv.org/pdf/1706.03762.pdf>&ldquo;Attention Is All You Need&rdquo;</a>) has shown that the various proposed mechanism for answering generic semantic correctness questions are exceedingly promising. We use them to train our elementary arithmetic model in telling us if a simple mathematical expression is correct or not.</p><p>Please note that we have too much accumulated code to load into our notebook. For your reference, we sample from the attached local source files: <em>datasets.py, layers.py, main.py, modules.py, samples.py, tasks.py, trafo.py</em> and <em>utils.py</em>.</p><h2 id=synthesized-samples>Synthesized samples</h2><p>The <code>Samples</code> class randomly generates samples from an on-demand allocated pool of values. The size of the pool is set by the <code>dim_pool</code> param and using it with large values helps with keeping the probability distributions in check.</p><p>Currently, <code>Samples</code> can generate a variety of 10 different groups of samples. In this blog we focus on <code>yes-no</code> (YNS), <code>masked</code> (MSK), <code>reversed</code> (REV) and <code>faulty</code> (FIX) samples.</p><p>A simple sample generating loop can be as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>samples</span> <span class=k>as</span> <span class=nn>qs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>groups</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=s1>&#39;yns ynx msk msx cls clx qas rev gen fix&#39;</span><span class=o>.</span><span class=n>split</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>YNS</span><span class=p>,</span> <span class=n>YNX</span><span class=p>,</span> <span class=n>MSK</span><span class=p>,</span> <span class=n>MSX</span><span class=p>,</span> <span class=n>CLS</span><span class=p>,</span> <span class=n>CLX</span><span class=p>,</span> <span class=n>QAS</span><span class=p>,</span> <span class=n>REV</span><span class=p>,</span> <span class=n>GEN</span><span class=p>,</span> <span class=n>FIX</span> <span class=o>=</span> <span class=n>groups</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sampler</span><span class=p>(</span><span class=n>ps</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ss</span> <span class=o>=</span> <span class=n>qs</span><span class=o>.</span><span class=n>Samples</span><span class=p>(</span><span class=n>ps</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ps</span><span class=o>.</span><span class=n>num_samples</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ss</span><span class=p>,</span> <span class=n>idx</span> <span class=o>=</span> <span class=n>ss</span><span class=o>.</span><span class=n>next_idx</span>
</span></span><span class=line><span class=cl>        <span class=n>enc</span><span class=p>,</span> <span class=n>res</span><span class=p>,</span> <span class=o>*</span><span class=n>_</span> <span class=o>=</span> <span class=n>ss</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>dec</span> <span class=o>=</span> <span class=n>tgt</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;[</span><span class=si>{</span><span class=n>res</span><span class=si>}</span><span class=s1>]&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>bad</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;[</span><span class=si>{</span><span class=n>ss</span><span class=o>.</span><span class=n>other</span><span class=p>(</span><span class=n>res</span><span class=p>)</span><span class=si>}</span><span class=s1>]&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>yn</span> <span class=o>=</span> <span class=n>ss</span><span class=o>.</span><span class=n>yns</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>idx</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>d2</span> <span class=o>=</span> <span class=n>dec</span> <span class=k>if</span> <span class=n>yn</span> <span class=k>else</span> <span class=n>bad</span>
</span></span><span class=line><span class=cl>        <span class=n>yns</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>enc</span><span class=o>=</span><span class=n>enc</span><span class=p>,</span> <span class=n>dec</span><span class=o>=</span><span class=n>d2</span> <span class=o>+</span> <span class=s1>&#39;|_&#39;</span><span class=p>,</span> <span class=n>tgt</span><span class=o>=</span><span class=n>d2</span> <span class=o>+</span> <span class=sa>f</span><span class=s1>&#39;|</span><span class=si>{</span><span class=n>yn</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=p>{</span><span class=n>YNS</span><span class=p>:</span> <span class=n>yns</span><span class=p>}</span>
</span></span></code></pre></div><p>The generated samples are Python <code>dict</code>s with the previously introduced <code>enc</code> (encoder), <code>dec</code> (decoder) and <code>tgt</code> (target) features.</p><p>Both <code>dec</code> and <code>tgt</code> features end the sample with <code>|</code> and the yes-no answer is encoded as <code>1</code> and <code>0</code> (the <code>_</code> is the place-holder that the decoder needs to solve).</p><p>And now we can generate a few samples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>utils</span> <span class=k>as</span> <span class=nn>qu</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ps</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_pool</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>max_val</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_samples</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ps</span> <span class=o>=</span> <span class=n>qu</span><span class=o>.</span><span class=n>Params</span><span class=p>(</span><span class=o>**</span><span class=n>ps</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>sampler</span><span class=p>(</span><span class=n>ps</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>d</span><span class=p>[</span><span class=n>YNS</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>  <span class=o>{</span><span class=s1>&#39;enc&#39;</span>: <span class=s1>&#39;x=81,y=11;x+y&#39;</span>, <span class=s1>&#39;dec&#39;</span>: <span class=s1>&#39;[10]|_&#39;</span>, <span class=s1>&#39;tgt&#39;</span>: <span class=s1>&#39;[10]|0&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span><span class=s1>&#39;enc&#39;</span>: <span class=s1>&#39;y=-99,x=-58;x+y&#39;</span>, <span class=s1>&#39;dec&#39;</span>: <span class=s1>&#39;[-157]|_&#39;</span>, <span class=s1>&#39;tgt&#39;</span>: <span class=s1>&#39;[-157]|1&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span><span class=s1>&#39;enc&#39;</span>: <span class=s1>&#39;x=13,y=-79;y-x&#39;</span>, <span class=s1>&#39;dec&#39;</span>: <span class=s1>&#39;[-92]|_&#39;</span>, <span class=s1>&#39;tgt&#39;</span>: <span class=s1>&#39;[-92]|1&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span><span class=s1>&#39;enc&#39;</span>: <span class=s1>&#39;y=-33,x=-30;y+x&#39;</span>, <span class=s1>&#39;dec&#39;</span>: <span class=s1>&#39;[-96]|_&#39;</span>, <span class=s1>&#39;tgt&#39;</span>: <span class=s1>&#39;[-96]|0&#39;</span><span class=o>}</span>
</span></span></code></pre></div><p>While we don&rsquo;t show any of the other samples in this blog, the <code>MSK</code> features mask the results at random positions with a <code>?</code>, the <code>REV</code> samples mix up the order of the variables and <code>FIX</code> samples randomly introduce an error digit in the results.</p><h2 id=model-definition>Model definition</h2><p>The actual model is largely similar to the models already presented in the previous blogs.</p><p>Based on what group of samples we are using, we activate some layers in the model while ignoring others.</p><p>A significant consideration is that all the 10 groups of samples contribute (if meaningful) to the same weights (or variables).</p><p>We chose to do this this based on the results of the <a href=https://arxiv.org/pdf/1901.11504.pdf>MT-DNN</a> paper. Varying the type and challenge of the samples we effectively cross-train the model.</p><p>In order to clearly separate the <code>loss</code> and <code>metric</code> calculations between the groups, we create a new instance of our model for each group of samples. However, we reuse the same layers.</p><p>To accomplish this, we define an <code>lru_cache</code> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>functools</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@functools</span><span class=o>.</span><span class=n>lru_cache</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>layer_for</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>pa</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=bp>cls</span><span class=p>(</span><span class=o>*</span><span class=n>pa</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span></code></pre></div><p>And now, our usual <code>model_for</code> function looks as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>model_for</span><span class=p>(</span><span class=n>ps</span><span class=p>,</span> <span class=n>group</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>inputs</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>ToRagged</span><span class=p>)(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>yt</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Tokens</span><span class=p>,</span> <span class=n>ps</span><span class=p>)(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ym</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Metas</span><span class=p>,</span> <span class=n>ps</span><span class=p>)(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>xe</span><span class=p>,</span> <span class=n>xd</span> <span class=o>=</span> <span class=n>yt</span><span class=p>[:</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=n>ym</span><span class=p>[:</span><span class=mi>1</span><span class=p>],</span> <span class=n>yt</span><span class=p>[</span><span class=mi>2</span><span class=p>:]</span> <span class=o>+</span> <span class=n>ym</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>embed</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Embed</span><span class=p>,</span> <span class=n>ps</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ye</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Encode</span><span class=p>,</span> <span class=n>ps</span><span class=p>)(</span><span class=n>embed</span><span class=p>(</span><span class=n>xe</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>decode</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Decode</span><span class=p>,</span> <span class=n>ps</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>group</span> <span class=ow>in</span> <span class=p>(</span><span class=n>qs</span><span class=o>.</span><span class=n>YNS</span><span class=p>,</span> <span class=n>qs</span><span class=o>.</span><span class=n>YNX</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>decode</span><span class=p>(</span><span class=n>embed</span><span class=p>(</span><span class=n>xd</span><span class=p>)</span> <span class=o>+</span> <span class=p>[</span><span class=n>ye</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Debed</span><span class=p>,</span> <span class=n>ps</span><span class=p>)(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>group</span> <span class=ow>in</span> <span class=p>(</span><span class=n>qs</span><span class=o>.</span><span class=n>MSK</span><span class=p>,</span> <span class=n>qs</span><span class=o>.</span><span class=n>MSX</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Deduce</span><span class=p>,</span> <span class=n>ps</span><span class=p>,</span> <span class=n>embed</span><span class=p>,</span> <span class=n>decode</span><span class=p>)(</span><span class=n>xd</span> <span class=o>+</span> <span class=p>[</span><span class=n>ye</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>group</span> <span class=ow>in</span> <span class=p>(</span><span class=n>qs</span><span class=o>.</span><span class=n>QAS</span><span class=p>,</span> <span class=n>qs</span><span class=o>.</span><span class=n>FIX</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>decode</span><span class=p>(</span><span class=n>embed</span><span class=p>(</span><span class=n>xd</span><span class=p>)</span> <span class=o>+</span> <span class=p>[</span><span class=n>ye</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>layer_for</span><span class=p>(</span><span class=n>ql</span><span class=o>.</span><span class=n>Locate</span><span class=p>,</span> <span class=n>ps</span><span class=p>,</span> <span class=n>group</span><span class=p>)(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>Model</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;trafo&#39;</span><span class=p>,</span> <span class=n>inputs</span><span class=o>=</span><span class=n>x</span><span class=p>,</span> <span class=n>outputs</span><span class=o>=</span><span class=p>[</span><span class=n>y</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>optimizer</span><span class=o>=</span><span class=n>ps</span><span class=o>.</span><span class=n>optimizer</span><span class=p>,</span> <span class=n>loss</span><span class=o>=</span><span class=n>ps</span><span class=o>.</span><span class=n>loss</span><span class=p>,</span> <span class=n>metrics</span><span class=o>=</span><span class=p>[</span><span class=n>ps</span><span class=o>.</span><span class=n>metric</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>summary</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span>
</span></span></code></pre></div><h2 id=expanded-parameters>Expanded parameters</h2><p>As we have expanded the functionality of our layers and modules from the previous blogs, our params have increased in number.</p><p>Also, the subsequent blogs in this section will describe the additions to the model&rsquo;s extended functionality.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>tensorflow</span> <span class=k>as</span> <span class=nn>tf</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datasets</span> <span class=k>as</span> <span class=nn>qd</span>
</span></span><span class=line><span class=cl><span class=n>ks</span> <span class=o>=</span> <span class=n>tf</span><span class=o>.</span><span class=n>keras</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>activ_concl</span><span class=o>=</span><span class=s1>&#39;gelu&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_attn</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_attn_qk</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_attn_v</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_batch</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_concl</span><span class=o>=</span><span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_hidden</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_hist</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_metas</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>qd</span><span class=o>.</span><span class=n>metas</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_stacks</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_vocab</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>qd</span><span class=o>.</span><span class=n>vocab</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>drop_attn</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>drop_concl</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>drop_hidden</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>initer_stddev</span><span class=o>=</span><span class=mf>0.02</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>loss</span><span class=o>=</span><span class=n>ks</span><span class=o>.</span><span class=n>losses</span><span class=o>.</span><span class=n>SparseCategoricalCrossentropy</span><span class=p>(</span><span class=n>from_logits</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>metric</span><span class=o>=</span><span class=n>ks</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>SparseCategoricalCrossentropy</span><span class=p>(</span><span class=n>from_logits</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>num_epochs</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_heads</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_rounds</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_shards</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>optimizer</span><span class=o>=</span><span class=n>ks</span><span class=o>.</span><span class=n>optimizers</span><span class=o>.</span><span class=n>Adam</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>width_dec</span><span class=o>=</span><span class=mi>40</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>width_enc</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>params</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>loss</span><span class=o>=</span><span class=n>qu</span><span class=o>.</span><span class=n>Loss</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>metric</span><span class=o>=</span><span class=n>qu</span><span class=o>.</span><span class=n>Metric</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>And this is our new <code>main</code> function that loops through all the samples in all of our groups of samples and either trains the model on the samples or performs an evaluation/prediction.</p><p>In the follow-on blogs we present the various training/eval/predict functions that our main loop can use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>ps</span><span class=p>,</span> <span class=n>fn</span><span class=p>,</span> <span class=n>groups</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>count</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>qu</span><span class=o>.</span><span class=n>Config</span><span class=o>.</span><span class=n>runtime</span><span class=o>.</span><span class=n>is_training</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>groups</span> <span class=o>=</span> <span class=n>groups</span> <span class=ow>or</span> <span class=n>qs</span><span class=o>.</span><span class=n>groups</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ps</span><span class=o>.</span><span class=n>num_rounds</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>groups</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>Round </span><span class=si>{</span><span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s1>, group </span><span class=si>{</span><span class=n>g</span><span class=si>}</span><span class=s1>...</span><span class=se>\n</span><span class=s1>=======================&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>fn</span><span class=p>(</span><span class=n>ps</span><span class=p>,</span> <span class=n>qd</span><span class=o>.</span><span class=n>dset_for</span><span class=p>(</span><span class=n>ps</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>count</span><span class=o>=</span><span class=n>count</span><span class=p>),</span> <span class=n>model_for</span><span class=p>(</span><span class=n>ps</span><span class=p>,</span> <span class=n>g</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=generating-samples>Generating samples</h2><p>Before we start a training session, we need to generate some samples.</p><p>The code that generates the samples is similar to the following.</p><p>The <code>large</code> datasets generate 100 shards containing each 10,000 samples for every every sample group out of the current 10.</p><p>The total number of samples for the <code>large</code> dataset can be easily varied, however, with the pictured settings, it amounts to <strong>10 million samples</strong> that a server with 40 hyper-threads generates in about 3 hours.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ds_small</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_batch</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_pool</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>max_val</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_samples</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_shards</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ds_large</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_batch</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>dim_pool</span><span class=o>=</span><span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>max_val</span><span class=o>=</span><span class=mi>100000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_samples</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_shards</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dump_ds</span><span class=p>(</span><span class=n>kind</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ps</span> <span class=o>=</span> <span class=n>qu</span><span class=o>.</span><span class=n>Params</span><span class=p>(</span><span class=o>**</span><span class=p>(</span><span class=n>ds_small</span> <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s1>&#39;small&#39;</span> <span class=k>else</span> <span class=n>ds_large</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ss</span> <span class=o>=</span> <span class=p>[</span><span class=n>s</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>qd</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>ps</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;/tmp/q/data/</span><span class=si>{</span><span class=n>kind</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>ds</span> <span class=o>=</span> <span class=n>qd</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>ps</span><span class=p>,</span> <span class=n>shards</span><span class=o>=</span><span class=n>ss</span><span class=p>)</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>qd</span><span class=o>.</span><span class=n>adapter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>ds</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;dumped </span><span class=si>{</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s1> batches of </span><span class=si>{</span><span class=n>ps</span><span class=o>.</span><span class=n>dim_batch</span><span class=si>}</span><span class=s1> samples each&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>And here is an actual call to generate our <code>small</code> sample set:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=err>!</span><span class=n>python</span> <span class=n>main</span><span class=o>.</span><span class=n>py</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>  dumping /tmp/q/data/small/cls/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/msk/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/yns/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/qas/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/clx/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/msx/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/ynx/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/rev/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/gen/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/yns/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/msk/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/cls/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/fix/shard_0000.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/ynx/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/clx/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/msx/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/qas/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/gen/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/rev/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumping /tmp/q/data/small/fix/shard_0001.tfrecords...
</span></span><span class=line><span class=cl>  dumped <span class=m>80</span> batches of <span class=m>5</span> samples each
</span></span></code></pre></div><h2 id=training-session>Training session</h2><p>Now we are ready to run a short training session:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=err>!</span><span class=n>python</span> <span class=n>trafo</span><span class=o>.</span><span class=n>py</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>  Round 1, group yns...
</span></span><span class=line><span class=cl>  <span class=o>=======================</span>
</span></span><span class=line><span class=cl>  Epoch 1/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 9s 4s/step - loss: 3.2370 - metric: 3.2364
</span></span><span class=line><span class=cl>  Epoch 2/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 0s 84ms/step - loss: 3.2212 - metric: 3.2209
</span></span><span class=line><span class=cl>  Round 1, group msk...
</span></span><span class=line><span class=cl>  <span class=o>=======================</span>
</span></span><span class=line><span class=cl>  Epoch 1/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 32s 16s/step - loss: 3.2135 - metric: 3.2134
</span></span><span class=line><span class=cl>  Epoch 2/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 0s 119ms/step - loss: 3.2034 - metric: 3.2032
</span></span><span class=line><span class=cl>  Round 1, group qas...
</span></span><span class=line><span class=cl>  <span class=o>=======================</span>
</span></span><span class=line><span class=cl>  Epoch 1/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 7s 4s/step - loss: 3.4434 - metric: 3.4434
</span></span><span class=line><span class=cl>  Epoch 2/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 0s 82ms/step - loss: 2.7450 - metric: 2.7450
</span></span><span class=line><span class=cl>  Round 2, group yns...
</span></span><span class=line><span class=cl>  <span class=o>=======================</span>
</span></span><span class=line><span class=cl>  Epoch 1/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 7s 4s/step - loss: 3.2059 - metric: 3.2070
</span></span><span class=line><span class=cl>  Epoch 2/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 0s 79ms/step - loss: 3.1923 - metric: 3.1935
</span></span><span class=line><span class=cl>  Round 2, group msk...
</span></span><span class=line><span class=cl>  <span class=o>=======================</span>
</span></span><span class=line><span class=cl>  Epoch 1/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 29s 14s/step - loss: 3.1887 - metric: 3.1887
</span></span><span class=line><span class=cl>  Epoch 2/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 0s 130ms/step - loss: 3.1745 - metric: 3.1744
</span></span><span class=line><span class=cl>  Round 2, group qas...
</span></span><span class=line><span class=cl>  <span class=o>=======================</span>
</span></span><span class=line><span class=cl>  Epoch 1/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 10s 5s/step - loss: 1.9412 - metric: 1.9412
</span></span><span class=line><span class=cl>  Epoch 2/2
</span></span><span class=line><span class=cl>  2/2 <span class=o>[==============================]</span> - 0s 89ms/step - loss: 1.3604 - metric: 1.3604
</span></span></code></pre></div><p>And this concludes our blog, please click on the next blog for more detail.</p></div></main></div><footer class="qal-footer py-5 bg-light"><div class=container><div class=row><div class=col-lg><a class=d-inline-flex href=../../><svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" class="d-block me-2" viewBox="0 0 118 94" role="img"><title>Silcrow</title><path d="m67.476567 58.848956q2.916668 2.114585 4.375002 4.812503t1.458334 5.942711q0 5.250002-4.520836 8.421879-4.520835 3.208335-10.60938 3.208335-5.541669.0-9.406254-2.552085-3.864586-2.552084-3.864586-6.270836.0-2.151043 1.421876-3.500002 1.421876-1.3125 3.208335-1.3125 1.932293.0 3.026043 1.09375 1.093751 1.130209 1.786459 3.609377.911459 3.09896 2.296876 3.97396 1.385418.911459 3.208335.911459 2.187501.0 3.75521-1.239584t1.567709-3.026043q0-1.458334-1.020833-3.135418-1.057293-1.640626-6.708337-5.468753-6.526045-4.375002-9.369796-6.781253-2.843751-2.44271-4.375002-5.322919-1.531251-2.916669-1.531251-6.19792.0-3.09896 1.348959-5.432294 1.385417-2.333335 3.208335-3.427085 1.822918-1.130209 4.302085-1.713543-3.098959-2.260418-4.666668-4.921877-1.56771-2.66146-1.56771-5.76042.0-5.322919 4.484378-8.640629 4.484377-3.354168 10.901046-3.354168 5.395836.0 9.333338 2.515626t3.937502 6.088545q0 2.114584-1.494792 3.463543-1.494793 1.348959-3.427085 1.348959-1.895834.0-2.843752-.984375-.947917-1.020834-1.859376-3.718752-.838542-2.552085-2.078125-3.609377-1.239584-1.057292-3.463544-1.057292-2.296876.0-3.937502 1.276042-1.604167 1.276043-1.604167 3.062502.0 2.041667 1.567709 3.682293 1.531251 1.640626 7.473962 5.432294 5.578128 3.572919 8.239587 5.76042 2.697918 2.151043 4.229169 5.140627 1.567709 2.989585 1.567709 6.453128.0 4.411461-2.078126 7.218754-2.078126 2.807293-6.270836 4.010418zm1.166667-7.000003q0-3.682293-6.234378-8.531254-6.19792-4.885419-9.187505-4.885419-1.385417.0-2.661459 1.09375-1.239584 1.057293-1.239584 2.515627.0 3.463543 6.307295 8.421879 6.343753 4.958335 9.260421 4.958335 1.53125.0 2.625001-1.057292 1.130209-1.057292 1.130209-2.515626z" fill="#0"/></svg><span class=fs-5>&copy; 2022 Qnarre</span></a><ul class="list-unstyled small text-muted"><li class=mb-2>Software is our passion.</li></ul></div></div></div></footer><script src=../../js/bootstrap.bundle.min.js></script>
<script src=../../js/script.min.js></script></body></html>